{% extends "base.html" %}

{% block title %}Post-Flight Submit - NAV Scoring{% endblock %}

{% block navbar %}
<div class="navbar">
    <div class="navbar-brand">
        <button class="hamburger" id="hamburgerBtn">‚ò∞</button>
        <h1>NAV Scoring - Post-Flight</h1>
    </div>
    <div class="navbar-links" id="navbarLinks">
        <a href="/dashboard">Dashboard</a>
        <a href="/profile">Profile</a>
        <a href="/logout">Logout</a>
    </div>
</div>
{% endblock %}

{% block content %}
<h2>Submit Flight Results</h2>
<div style="margin-bottom: 1.5rem;">
    <a href="/dashboard" style="display: inline-block; background: #8B0015; color: white; padding: 0.75rem 1.5rem; border-radius: 5px; text-decoration: none; transition: transform 0.2s;">‚Üê Return to Dashboard</a>
</div>


{% if error %}
<div class="error" style="padding: 15px; margin: 15px 0; border: 1px solid #d32f2f; background-color: #ffebee; color: #c62828; border-radius: 4px;">
    <strong>Error:</strong> {{ error }}<br>
    <a href="/flight/select" style="color: inherit; text-decoration: underline;">‚Üê Select a submission</a>
</div>
{% endif %}

{% if selected_prenav %}
<div class="info" style="margin-bottom: 1.5rem; padding: 15px; background-color: #e8f5e9; border-left: 4px solid #4caf50;">
    <strong>üìã Selected Pre-Flight Submission:</strong><br>
    <strong>Submitted:</strong> {{ selected_prenav.submitted_at_display }}<br>
    <strong>NAV Route:</strong> {{ selected_prenav.nav_name }}<br>
    <strong>Pairing:</strong> {{ selected_prenav.pilot_name }} (Pilot) + {{ selected_prenav.observer_name }} (Observer)<br>
    <strong>Estimated Time:</strong> {{ selected_prenav.total_time_display }}<br>
    <strong>Estimated Fuel:</strong> {{ selected_prenav.fuel_estimate }} gallons
</div>

<div class="info">
    <strong>Instructions:</strong><br>
    1. Select the start gate you used<br>
    2. Upload your GPX file from the flight<br>
    3. Enter actual fuel burn and secrets missed<br>
    4. Get instant score!
</div>

<form method="POST" action="/flight" enctype="multipart/form-data">
    <input type="hidden" name="prenav_id" value="{{ selected_prenav.id }}">
    
    <div class="form-group">
        <label for="start_gate_id">Start Gate:</label>
        <select id="start_gate_id" name="start_gate_id" required>
            <option value="">-- Select Start Gate --</option>
            {% for gate in start_gates %}
            <option value="{{ gate.id }}">{{ gate.name }}</option>
            {% endfor %}
        </select>
    </div>
    
    <div class="form-group">
        <label for="gpx_file">GPX File:</label>
        <input type="file" id="gpx_file" name="gpx_file" accept=".gpx" required>
        <small style="color: #666;">Upload the GPX track file from your flight</small>
    </div>
    
    <div class="form-group">
        <label for="actual_fuel">Actual Fuel Burn (gallons):</label>
        <input type="number" id="actual_fuel" name="actual_fuel" 
               step="0.1" min="0" placeholder="8.5" required>
    </div>
    
    <div class="form-group">
        <label for="secrets_checkpoint">Checkpoint Secrets Missed:</label>
        <input type="number" id="secrets_checkpoint" name="secrets_checkpoint" 
               min="0" value="0" required>
        <small style="color: #666;">Count of checkpoint secrets you missed</small>
    </div>
    
    <div class="form-group">
        <label for="secrets_enroute">Enroute Secrets Missed:</label>
        <input type="number" id="secrets_enroute" name="secrets_enroute" 
               min="0" value="0" required>
        <small style="color: #666;">Count of enroute secrets you missed</small>
    </div>
    
    <div class="button-group">
        <button type="submit">Submit & Score Flight</button>
        <a href="/dashboard" class="button" style="background: #666; text-decoration: none; display: inline-block; text-align: center;">Return to Dashboard</a>
    </div>
</form>

{% else %}
<div class="info" style="margin-top: 1.5rem; padding: 20px; background-color: #fff3cd; border-left: 4px solid #ffc107;">
    <strong>No pre-flight submission selected.</strong><br>
    Please select a submission from the selection page to continue.
    <div style="margin-top: 1rem;">
        <a href="/flight/select" class="button">‚Üê Select a Submission</a>
    </div>
</div>
{% endif %}
{% endblock %}
